<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My IP & Location</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+e2jvH6fYq9r3gq4jv+F3oY+6k0kqKkT1f8g9x2vM="
    crossorigin=""
  />

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      margin: 0;
      padding: 1rem;
      background: #f8fafc;
      color: #111;
    }
    header { margin-bottom: 1rem; }
    #map { height: 60vh; border-radius: 10px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
    .card { background:white; padding:1rem; border-radius:10px; box-shadow: 0 6px 20px rgba(0,0,0,0.04); margin-bottom:1rem; }
    .small { font-size:0.9rem; color:#555; }
    button {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: none;
      background: #2563eb;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #1e50c9; }
    pre { background:#f1f5f9; padding:0.6rem; border-radius:6px; overflow:auto; }
  </style>
</head>
<body>
  <header>
    <h1>My IP & Location</h1>
    <p class="small">
      This tool shows your public IP and live location directly in your browser.
      No data is stored or sent anywhere.
    </p>
  </header>

  <div class="card">
    <p><strong>Public IP:</strong> <span id="ip">Loading...</span></p>
    <p><strong>Coordinates:</strong> <span id="coords">Not yet available</span></p>
    <p class="small">
      When your browser asks for permission to access your location, click <em>Allow</em>.
    </p>
    <button id="reloadBtn">Check Again</button>
  </div>

  <div id="map" class="card"></div>

  <div class="card small">
    <p><strong>Privacy Notice:</strong></p>
    <ul>
      <li>All processing happens in your browser (client-side).</li>
      <li>Public IP is fetched securely via <code>https://api64.ipify.org</code>.</li>
      <li>Geolocation requires HTTPS or localhost.</li>
    </ul>
  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1jQ2v0g3z1K+8bWkG6r1mK2cQ1Ff6mZ6t2s3U9yk="
    crossorigin=""
  ></script>

  <script>
    const ipEl = document.getElementById("ip");
    const coordsEl = document.getElementById("coords");
    const reloadBtn = document.getElementById("reloadBtn");

    // Initialize map
    const map = L.map("map").setView([20, 0], 2);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    let marker = null;

    async function fetchIP() {
      try {
        const res = await fetch("https://api64.ipify.org?format=json");
        const data = await res.json();
        ipEl.textContent = data.ip || "Unavailable";
      } catch (e) {
        ipEl.textContent = "Failed to load IP";
        console.error(e);
      }
    }

    function showLocation() {
      if (!navigator.geolocation) {
        coordsEl.textContent = "Geolocation not supported by this browser.";
        return;
      }

      coordsEl.textContent = "Locating…";

      navigator.geolocation.getCurrentPosition(
        pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const acc = pos.coords.accuracy;

          coordsEl.textContent = `${lat.toFixed(6)}, ${lon.toFixed(6)} (±${Math.round(acc)} m)`;

          map.setView([lat, lon], 13);
          if (marker) marker.setLatLng([lat, lon]);
          else marker = L.marker([lat, lon]).addTo(map).bindPopup("You are here").openPopup();
        },
        err => {
          console.warn("Location error:", err);
          if (err.code === 1) coordsEl.textContent = "Permission denied.";
          else if (err.code === 2) coordsEl.textContent = "Position unavailable.";
          else if (err.code === 3) coordsEl.textContent = "Request timed out.";
          else coordsEl.textContent = "Unknown error.";
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }

    reloadBtn.addEventListener("click", () => {
      fetchIP();
      showLocation();
    });

    // Run on load
    fetchIP();
    showLocation();
  </script>
</body>
</html>
